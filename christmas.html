```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ£è¯éŸ³ä¹æ ‘ - è€ç‹ç¥ä½ åœ£è¯èŠ‚å¿«ä¹ï¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'Arial Rounded MT Bold', sans-serif;
            background: linear-gradient(135deg, #0a1c30 0%, #1a2b3c 100%);
            color: white;
            overflow: hidden;
            position: relative;
            min-height: 100vh;
        }
        
        /* åœ£è¯è£…é¥°èƒŒæ™¯ */
        .christmas-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
            overflow: hidden;
        }
        
        /* ç¥ç¦è¯­åŒºåŸŸ - å æ®ä¸ŠåŠéƒ¨åˆ† */
        .greeting-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 70vh; /* å ç”¨70%çš„è§†å£é«˜åº¦ */
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            pointer-events: none;
        }
        
        /* æ§åˆ¶é¢æ¿åŒºåŸŸ - å›ºå®šåœ¨ä¸‹åŠéƒ¨åˆ† */
        .control-section {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30vh; /* å ç”¨30%çš„è§†å£é«˜åº¦ */
            z-index: 1001;
            display: flex;
            flex-direction: column;
            justify-content: flex-end; /* ä»åº•éƒ¨å¼€å§‹ */
            align-items: center;
            padding: 20px;
            background: linear-gradient(to top, 
                rgba(10, 28, 48, 0.95) 0%, 
                rgba(26, 43, 60, 0.8) 50%,
                transparent 100%);
            backdrop-filter: blur(5px);
            pointer-events: auto;
        }
        
        .main-greeting {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 20px;
            padding: 15px 30px;
            border-radius: 15px;
            background: linear-gradient(135deg, 
                rgba(220, 20, 60, 0.85) 0%,      /* åœ£è¯çº¢ */
                rgba(255, 69, 0, 0.85) 50%,      /* ç«æ©™ */
                rgba(255, 215, 0, 0.85) 100%     /* åœ£è¯é‡‘ */
            );
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 
                0 0 15px rgba(220, 20, 60, 0.5),
                0 0 30px rgba(255, 69, 0, 0.3),
                0 0 45px rgba(255, 215, 0, 0.2);
            animation: greetingGlow 3s ease-in-out infinite alternate;
            border: 2px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        @keyframes greetingGlow {
            0% { 
                transform: scale(1) translateY(0);
                text-shadow: 
                    0 0 15px rgba(220, 20, 60, 0.5),
                    0 0 30px rgba(255, 69, 0, 0.3),
                    0 0 45px rgba(255, 215, 0, 0.2);
            }
            100% { 
                transform: scale(1.03) translateY(-3px);
                text-shadow: 
                    0 0 20px rgba(220, 20, 60, 0.7),
                    0 0 40px rgba(255, 69, 0, 0.5),
                    0 0 60px rgba(255, 215, 0, 0.3);
            }
        }
        
        .special-name {
            color: #ffd700;  /* é‡‘è‰² */
            text-shadow: 
                0 0 10px #ffd700,
                0 0 20px #ff4500;
            font-style: italic;
        }
        
        .sub-greeting {
            font-size: 2rem;
            color: #32cd32;  /* åœ£è¯ç»¿ */
            margin-bottom: 25px;
            padding: 10px 20px;
            background: rgba(46, 125, 50, 0.2);
            border-radius: 12px;
            border: 1px solid rgba(50, 205, 50, 0.4);
            text-shadow: 0 0 12px rgba(50, 205, 50, 0.7);
        }
        
        .message-container {
            background: linear-gradient(135deg, 
                rgba(25, 25, 112, 0.7) 0%,      /* åˆå¤œè“ */
                rgba(70, 130, 180, 0.7) 100%    /* é’¢è“ */
            );
            padding: 20px 30px;
            border-radius: 15px;
            max-width: 700px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 
                0 10px 25px rgba(0, 0, 0, 0.4),
                inset 0 0 20px rgba(255, 215, 0, 0.1);
        }
        
        .message {
            font-size: 1.5rem;
            line-height: 1.6;
            color: #ffebcd;  /* æä»ç™½ */
            text-shadow: 0 0 8px rgba(255, 235, 205, 0.5);
        }
        
        .christmas-emoji {
            display: inline-block;
            animation: emojiBounce 2s infinite;
            margin: 0 5px;
        }
        
        @keyframes emojiBounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-8px) scale(1.1); }
        }
        
        /* éŸ³ä¹æ§åˆ¶é¢æ¿ */
        .control-panel {
            width: 100%;
            max-width: 800px;
            text-align: center;
            margin-bottom: 10px; /* å‡å°‘åº•éƒ¨é—´è· */
        }
        
        .main-control {
            margin-bottom: 15px;
        }
        
        .music-btn {
            background: linear-gradient(135deg, #dc143c, #ff4500);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 
                0 4px 15px rgba(220, 20, 60, 0.4),
                inset 0 0 8px rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: 1px solid rgba(255, 215, 0, 0.5);
            min-width: 140px;
            margin: 0 auto;
        }
        
        .music-btn:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 8px 20px rgba(220, 20, 60, 0.6),
                inset 0 0 12px rgba(255, 255, 255, 0.3);
        }
        
        .music-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* ä¸‰åˆ—å¸ƒå±€ */
            gap: 10px;
            margin-top: 10px;
        }
        
        .music-option {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(30, 58, 138, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .music-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 58, 138, 0.6);
            background: linear-gradient(135deg, #3b82f6, #1e3a8a);
        }
        
        .upload-area {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .upload-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
            padding: 10px 20px;
            border-radius: 15px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(5, 150, 105, 0.4);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .upload-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(5, 150, 105, 0.6);
        }
        
        .upload-input {
            display: none;
        }
        
        /* åŠ è½½ç•Œé¢ */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a1c30, #1a2b3c);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1s;
        }
        
        .loading-content {
            text-align: center;
            max-width: 700px;
            padding: 30px;
            background: rgba(25, 25, 112, 0.85);
            border-radius: 20px;
            border: 2px solid rgba(255, 215, 0, 0.4);
        }
        
        .loading-title {
            font-size: 3rem;
            color: #ffd700;
            margin-bottom: 20px;
            text-shadow: 0 0 15px #ffd700;
        }
        
        .loading-greeting {
            font-size: 2rem;
            color: #32cd32;
            margin-bottom: 25px;
            padding: 10px;
            background: rgba(46, 125, 50, 0.2);
            border-radius: 12px;
        }
        
        .music-selection {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .loading-btn {
            background: linear-gradient(135deg, #dc143c, #ff4500);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 15px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(220, 20, 60, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .loading-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(220, 20, 60, 0.6);
        }
        
        .text-loading {
            font-size: 2rem;
            color: #ffd700;
            margin: 20px 0;
            animation: loadingPulse 1.5s infinite alternate;
        }
        
        @keyframes loadingPulse {
            0% { opacity: 0.6; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.05); }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .greeting-section {
                height: 65vh; /* ç§»åŠ¨ç«¯è°ƒæ•´æ¯”ä¾‹ */
                padding: 15px;
            }
            
            .control-section {
                height: 35vh;
                padding: 15px;
            }
            
            .main-greeting {
                font-size: 2.8rem;
                padding: 12px 20px;
            }
            
            .sub-greeting {
                font-size: 1.6rem;
                padding: 8px 15px;
            }
            
            .message-container {
                padding: 15px 20px;
                max-width: 90%;
            }
            
            .message {
                font-size: 1.2rem;
            }
            
            .music-grid {
                grid-template-columns: repeat(2, 1fr); /* ç§»åŠ¨ç«¯ä¸¤åˆ— */
                gap: 8px;
            }
            
            .music-btn {
                padding: 10px 20px;
                font-size: 15px;
                min-width: 120px;
            }
            
            .music-option {
                padding: 8px 12px;
                font-size: 13px;
            }
            
            .loading-title {
                font-size: 2.2rem;
            }
            
            .loading-greeting {
                font-size: 1.6rem;
            }
            
            .music-selection {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .main-greeting {
                font-size: 2.2rem;
            }
            
            .sub-greeting {
                font-size: 1.3rem;
            }
            
            .message {
                font-size: 1.1rem;
            }
            
            .music-grid {
                grid-template-columns: 1fr; /* è¶…å°å±å¹•å•åˆ— */
            }
            
            .music-selection {
                grid-template-columns: 1fr;
            }
            
            .loading-btn {
                padding: 10px 15px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- åœ£è¯è£…é¥°èƒŒæ™¯ -->
    <div class="christmas-bg" id="christmas-bg"></div>
    
    <!-- ç¥ç¦è¯­åŒºåŸŸï¼ˆä¸ŠåŠéƒ¨åˆ†ï¼‰ -->
    <div class="greeting-section">
        <div class="main-greeting">
            <span class="special-name">è€ç‹</span>ç¥ä½ åœ£è¯èŠ‚å¿«ä¹ï¼
        </div>
        <div class="sub-greeting"><span class="christmas-emoji">ğŸ„</span> åœ£è¯éŸ³ä¹æ ‘ Â· ä¸“å±ç¥ç¦ <span class="christmas-emoji">ğŸ„</span></div>
        <div class="message-container">
            <div class="message" id="message-text">
                åœ¨è¿™ç¾å¦™çš„åœ£è¯å­£èŠ‚ï¼Œ<span class="christmas-emoji">ğŸ…</span> 
                æ„¿éŸ³ä¹ä¸ç¥ç¦é™ªä¼´ä½ åº¦è¿‡æ¸©é¦¨æ—¶å…‰ã€‚<span class="christmas-emoji">ğŸŒŸ</span><br>
                åœ£è¯æ ‘çš„æ¯ä¸€é“å…‰éƒ½åœ¨ä¸ºä½ é—ªè€€ï¼Œ<span class="christmas-emoji">âœ¨</span> 
                æ„¿ä½ çš„ç”Ÿæ´»å……æ»¡æ¬¢ä¹ä¸å¥‡è¿¹ï¼<span class="christmas-emoji">ğŸ</span>
            </div>
        </div>
    </div>
    
    <!-- æ§åˆ¶é¢æ¿åŒºåŸŸï¼ˆä¸‹åŠéƒ¨åˆ†ï¼‰ -->
    <div class="control-section">
        <div class="control-panel">
            <!-- ä¸»æ§åˆ¶æŒ‰é’® -->
            <div class="main-control">
                <button class="music-btn" onclick="toggleMusic()">
                    <span id="music-icon">â–¶ï¸</span> æ’­æ”¾/æš‚åœ
                </button>
            </div>
            
            <!-- éŸ³ä¹é€‰æ‹©ç½‘æ ¼ -->
            <div class="music-grid">
                <button class="music-option" onclick="changeMusic(0)">
                    <span class="christmas-emoji">â„ï¸</span> é›ªèŠ±åœ£è¯
                </button>
                <button class="music-option" onclick="changeMusic(1)">
                    <span class="christmas-emoji">ğŸ…</span> æ¬¢ä¹åœ£è¯
                </button>
                <button class="music-option" onclick="changeMusic(2)">
                    <span class="christmas-emoji">ğŸ””</span> é“ƒå„¿å®å½“
                </button>
            </div>
            
            <!-- ä¸Šä¼ åŒºåŸŸ -->
            <div class="upload-area">
                <label class="upload-label">
                    <span class="christmas-emoji">ğŸ“</span> ä¸Šä¼ éŸ³ä¹
                    <input type="file" accept="audio/*" class="upload-input" onchange="uploadAudio(event)">
                </label>
            </div>
        </div>
    </div>
    
    <!-- åŠ è½½ç•Œé¢ -->
    <div id="overlay">
        <div class="loading-content">
            <div class="loading-title">
                <span class="christmas-emoji">ğŸ„</span> åœ£è¯éŸ³ä¹æ ‘ <span class="christmas-emoji">ğŸ„</span>
            </div>
            <div class="loading-greeting">
                <span class="special-name">è€ç‹</span>ç¥ä½ åœ£è¯èŠ‚å¿«ä¹ï¼
            </div>
            
            <p style="color: #ffebcd; font-size: 1.3rem; margin-bottom: 20px;">
                é€‰æ‹©ä¸€é¦–åœ£è¯éŸ³ä¹å¼€å§‹ç¾å¦™æ—…ç¨‹
            </p>
            
            <!-- åŠ è½½ç•Œé¢çš„éŸ³ä¹é€‰æ‹©ï¼ˆä¸‰é¦–ï¼‰ -->
            <div class="music-selection">
                <button class="loading-btn" onclick="loadAudio(0)">
                    <span class="christmas-emoji">â„ï¸</span> é›ªèŠ±åœ£è¯
                </button>
                <button class="loading-btn" onclick="loadAudio(1)">
                    <span class="christmas-emoji">ğŸ…</span> æ¬¢ä¹åœ£è¯
                </button>
                <button class="loading-btn" onclick="loadAudio(2)">
                    <span class="christmas-emoji">ğŸ””</span> é“ƒå„¿å®å½“
                </button>
            </div>
            
            <!-- ä¸Šä¼ æŒ‰é’® -->
            <label style="display: inline-block; margin-top: 15px;">
                <input type="file" accept="audio/*" style="display: none;" onchange="uploadAudio(event)">
                <div class="loading-btn" style="background: linear-gradient(135deg, #059669, #10b981);">
                    <span class="christmas-emoji">ğŸ“</span> ä¸Šä¼ æœ¬åœ°éŸ³ä¹
                </div>
            </label>
            
            <div class="text-loading" id="loading-text">
                ğŸµ å‡†å¤‡åœ£è¯é­”æ³• ğŸµ
            </div>
        </div>
    </div>

    <!-- Three.js åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>

    <script>
        // åœ£è¯ç¥ç¦è¯­æ•°ç»„
        const christmasMessages = [
            "åœ¨è¿™ç¾å¦™çš„åœ£è¯å­£èŠ‚ï¼ŒğŸ… æ„¿éŸ³ä¹ä¸ç¥ç¦é™ªä¼´ä½ åº¦è¿‡æ¸©é¦¨æ—¶å…‰ã€‚ğŸŒŸ åœ£è¯æ ‘çš„æ¯ä¸€é“å…‰éƒ½åœ¨ä¸ºä½ é—ªè€€ï¼Œâœ¨ æ„¿ä½ çš„ç”Ÿæ´»å……æ»¡æ¬¢ä¹ä¸å¥‡è¿¹ï¼ğŸ",
            "åœ£è¯é’Ÿå£°å“èµ·æ—¶ï¼ŒğŸ”” æ„¿æ‰€æœ‰çš„ç¾å¥½éƒ½é™ä¸´åœ¨ä½ èº«è¾¹ã€‚ğŸŒŸ æ„¿è¿™ä¸ªåœ£è¯èŠ‚å¸¦ç»™ä½ æ— é™çš„æ¬¢ä¹ï¼ŒğŸ„ æ–°å¹´çš„æ¯ä¸€å¤©éƒ½ç¿çƒ‚å¦‚å…‰ï¼âœ¨",
            "é›ªèŠ±é£˜è½çš„å­£èŠ‚ï¼Œâ„ï¸ æ„¿æ¸©æš–å¸¸é©»ä½ å¿ƒé—´ã€‚ğŸ… åœ£è¯çš„é­”æ³•å·²ç»é™ä¸´ï¼Œâœ¨ æ„¿è€ç‹çš„ç”Ÿæ´»å……æ»¡æƒŠå–œä¸ç¾å¥½ï¼ğŸ",
            "ä»åœ£è¯æ ‘çš„å…‰èŠ’åˆ°æ–°å¹´çš„æ›™å…‰ï¼ŒğŸŒŸ æ„¿å¹¸ç¦ä¸ä½ ä¸€è·¯åŒè¡Œã€‚ğŸ„ åœ¨è¿™ä¸ªç‰¹åˆ«çš„èŠ‚æ—¥é‡Œï¼Œâœ¨ é€ä¸Šæœ€çœŸæŒšçš„ç¥ç¦ï¼ğŸ…"
        ];

        const { PI, sin, cos } = Math;
        const TAU = 2 * PI;

        let scene, camera, renderer, analyser;
        let step = 0;
        const uniforms = {
            time: { type: "f", value: 0.0 },
            step: { type: "f", value: 0.0 },
        };
        const params = {
            exposure: 1,
            bloomStrength: 1.2,
            bloomThreshold: 0,
            bloomRadius: 0.8,
        };
        let composer;
        let currentMusicIndex = 0;
        let isPlaying = false;

        const fftSize = 2048;
        const totalPoints = 4000;

        const listener = new THREE.AudioListener();
        const audio = new THREE.Audio(listener);

        // ä¸‰é¦–åœ£è¯éŸ³ä¹ï¼ˆç§»é™¤äº†æ‘‡æ‘†åœ£è¯ï¼‰
        const musicFiles = [
            "https://files.freemusicarchive.org/storage-freemusicarchive-org/music/no_curator/Simon_Panrucker/Happy_Christmas_You_Guys/Simon_Panrucker_-_01_-_Snowflakes_Falling_Down.mp3",  // é›ªèŠ±åœ£è¯
            "https://files.freemusicarchive.org/storage-freemusicarchive-org/music/no_curator/Dott/This_Christmas/Dott_-_01_-_This_Christmas.mp3",  // æ¬¢ä¹åœ£è¯
            "https://files.freemusicarchive.org/storage-freemusicarchive-org/music/ccCommunity/TRG_Banks/TRG_Banks_Christmas_Album/TRG_Banks_-_12_-_No_room_at_the_inn.mp3"  // é“ƒå„¿å®å½“
        ];

        // åˆ›å»ºåœ£è¯èƒŒæ™¯è£…é¥°
        function createChristmasBackground() {
            const bg = document.getElementById('christmas-bg');
            
            // æ·»åŠ é›ªèŠ±
            for (let i = 0; i < 15; i++) {
                const snow = document.createElement('div');
                snow.style.position = 'absolute';
                snow.style.color = 'white';
                snow.style.fontSize = '20px';
                snow.style.opacity = '0.3';
                snow.innerHTML = 'â„';
                snow.style.left = `${Math.random() * 100}%`;
                snow.style.top = `${Math.random() * 100}%`;
                snow.style.animation = `snowFall ${15 + Math.random() * 15}s linear infinite`;
                snow.style.animationDelay = `${Math.random() * 5}s`;
                bg.appendChild(snow);
            }
            
            // æ·»åŠ é›ªèŠ±åŠ¨ç”»
            const style = document.createElement('style');
            style.textContent = `
                @keyframes snowFall {
                    0% { transform: translateY(-100px) rotate(0deg); }
                    100% { transform: translateY(100vh) rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
        }

        function init() {
            createChristmasBackground();
            
            const overlay = document.getElementById("overlay");
            overlay.style.opacity = "0";
            setTimeout(() => {
                overlay.style.display = "none";
            }, 1000);

            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x0a1c30, 10, 50);
            
            renderer = new THREE.WebGLRenderer({ 
                antialias: true,
                alpha: true 
            });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x0a1c30, 1);
            document.body.appendChild(renderer.domElement);

            camera = new THREE.PerspectiveCamera(
                60,
                window.innerWidth / window.innerHeight,
                1,
                1000
            );
            camera.position.set(-0.094, -2.56, 24.42);
            camera.rotation.set(0.104, -0.004, 0.0004);

            const format = renderer.capabilities.isWebGL2 ?
                THREE.RedFormat :
                THREE.LuminanceFormat;

            uniforms.tAudioData = {
                value: new THREE.DataTexture(analyser.data, fftSize / 2, 1, format),
            };

            // åˆ›å»ºä¸»åœ£è¯æ ‘
            addChristmasTree(scene, uniforms, totalPoints, [0, -5, 0]);
            
            // åˆ›å»ºå‘¨å›´çš„å°æ ‘
            for (let i = 0; i < 6; i++) {
                const angle = (i / 6) * TAU;
                const x = Math.cos(angle) * 12;
                const z = Math.sin(angle) * 12;
                addSmallTree(scene, uniforms, totalPoints / 2, [x, -5, z]);
            }

            // æ·»åŠ é›ªèŠ±
            addSnow(scene);
            
            // æ·»åŠ æ˜Ÿå…‰
            addStars(scene);

            const renderScene = new THREE.RenderPass(scene, camera);

            const bloomPass = new THREE.UnrealBloomPass(
                new THREE.Vector2(window.innerWidth, window.innerHeight),
                params.bloomStrength,
                params.bloomThreshold,
                params.bloomRadius
            );

            composer = new THREE.EffectComposer(renderer);
            composer.addPass(renderScene);
            composer.addPass(bloomPass);

            // è‡ªåŠ¨æ—‹è½¬ç›¸æœº
            let autoRotate = true;
            setInterval(() => {
                if (autoRotate) {
                    camera.position.x = Math.sin(Date.now() * 0.0003) * 18;
                    camera.position.z = Math.cos(Date.now() * 0.0003) * 18;
                    camera.lookAt(0, 0, 0);
                }
            }, 16);
            
            // ç‚¹å‡»æš‚åœè‡ªåŠ¨æ—‹è½¬
            renderer.domElement.addEventListener('click', () => {
                autoRotate = false;
                setTimeout(() => autoRotate = true, 8000);
            });

            animate();
        }

        function addChristmasTree(scene, uniforms, totalPoints, position) {
            const vertexShader = `
                attribute float mIndex;
                varying vec3 vColor;
                varying float opacity;
                uniform sampler2D tAudioData;
                uniform float time;
                uniform float step;
                
                float norm(float value, float min, float max){
                    return (value - min) / (max - min);
                }
                
                void main() {
                    float audioValue = texture2D(tAudioData, vec2(norm(mIndex, 0.0, ${totalPoints.toFixed(1)}), 0.0)).r;
                    
                    float height = position.y;
                    float radius = (1.0 - height) * 2.0;
                    float angle = position.x * 3.14159 * 2.0;
                    
                    vec3 pos = position;
                    pos.x = radius * cos(angle + time * 0.3) * (1.0 + audioValue * 0.8);
                    pos.z = radius * sin(angle + time * 0.3) * (1.0 + audioValue * 0.8);
                    pos.y = height * 3.0;
                    
                    pos.y += audioValue * 2.5;
                    pos.x += sin(time * 2.0 + mIndex * 0.1) * audioValue * 0.5;
                    pos.z += cos(time * 2.0 + mIndex * 0.1) * audioValue * 0.5;
                    
                    float r = 0.2 + height * 0.6 + audioValue * 0.4;
                    float g = 0.8 - height * 0.3 + audioValue * 0.3;
                    float b = 0.2 + audioValue * 0.6;
                    
                    vColor = vec3(r, g, b);
                    opacity = 0.8 + audioValue * 0.4;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos + vec3(${position[0]}, ${position[1]}, ${position[2]}), 1.0);
                    gl_PointSize = 4.0 + audioValue * 15.0;
                }
            `;
            
            const fragmentShader = `
                varying vec3 vColor;
                varying float opacity;
                
                void main() {
                    float dist = distance(gl_PointCoord, vec2(0.5, 0.5));
                    if (dist > 0.5) discard;
                    
                    float alpha = (1.0 - dist * 2.0) * opacity;
                    gl_FragColor = vec4(vColor, alpha);
                }
            `;

            const geometry = new THREE.BufferGeometry();
            const positions = [];
            const indices = [];
            
            for (let i = 0; i < totalPoints; i++) {
                const height = Math.random();
                const angle = Math.random() * TAU;
                const radius = (1 - height) * Math.random() * 0.9;
                
                positions.push(
                    radius * cos(angle),
                    height,
                    radius * sin(angle)
                );
                indices.push(i);
            }
            
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('mIndex', new THREE.Float32BufferAttribute(indices, 1));
            
            const material = new THREE.ShaderMaterial({
                uniforms: Object.assign({}, uniforms, {
                    tAudioData: uniforms.tAudioData
                }),
                vertexShader: vertexShader,
                fragmentShader: fragmentShader,
                transparent: true,
                blending: THREE.AdditiveBlending
            });
            
            const tree = new THREE.Points(geometry, material);
            scene.add(tree);
            
            return tree;
        }

        function addSmallTree(scene, uniforms, totalPoints, position) {
            const tree = addChristmasTree(scene, uniforms, totalPoints, position);
            tree.scale.set(0.4, 0.4, 0.4);
            return tree;
        }

        function addSnow(scene) {
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            const snowCount = 2000;
            
            for (let i = 0; i < snowCount; i++) {
                vertices.push(
                    (Math.random() - 0.5) * 100,
                    Math.random() * 50 - 10,
                    (Math.random() - 0.5) * 100
                );
            }
            
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            
            const material = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.1,
                transparent: true,
                opacity: 0.6
            });
            
            const snow = new THREE.Points(geometry, material);
            scene.add(snow);
            
            // é›ªèŠ±åŠ¨ç”»
            function animateSnow() {
                const positions = snow.geometry.attributes.position.array;
                for (let i = 1; i < positions.length; i += 3) {
                    positions[i] -= 0.02;
                    if (positions[i] < -10) positions[i] = 40;
                }
                snow.geometry.attributes.position.needsUpdate = true;
                requestAnimationFrame(animateSnow);
            }
            animateSnow();
        }

        function addStars(scene) {
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            const colors = [];
            const starCount = 800;
            
            for (let i = 0; i < starCount; i++) {
                vertices.push(
                    (Math.random() - 0.5) * 200,
                    Math.random() * 100 - 30,
                    (Math.random() - 0.5) * 200
                );
                
                colors.push(
                    0.8 + Math.random() * 0.2,
                    0.8 + Math.random() * 0.2,
                    0.8 + Math.random() * 0.2
                );
            }
            
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
            
            const material = new THREE.PointsMaterial({
                size: 0.2,
                vertexColors: true,
                transparent: true,
                opacity: 0.5
            });
            
            const stars = new THREE.Points(geometry, material);
            scene.add(stars);
        }

        function animate(time) {
            if (analyser) {
                analyser.getFrequencyData();
                uniforms.tAudioData.value.needsUpdate = true;
            }
            step = (step + 1) % 1000;
            uniforms.time.value = time * 0.001;
            uniforms.step.value = step;
            composer.render();
            requestAnimationFrame(animate);
        }

        function loadAudio(index) {
            currentMusicIndex = index;
            document.getElementById("overlay").innerHTML = '<div class="text-loading">ğŸµ åŠ è½½åœ£è¯éŸ³ä¹ä¸­...</div>';
            
            const loader = new THREE.AudioLoader();
            loader.load(musicFiles[index], function(buffer) {
                audio.setBuffer(buffer);
                audio.play();
                isPlaying = true;
                document.getElementById('music-icon').textContent = 'â¸ï¸';
                analyser = new THREE.AudioAnalyser(audio, fftSize);
                init();
            }, undefined, function(error) {
                document.getElementById("overlay").innerHTML = 
                    '<div class="text-loading">âŒ éŸ³ä¹åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•æˆ–ä¸Šä¼ æœ¬åœ°éŸ³ä¹</div>';
            });
        }

        function uploadAudio(event) {
            document.getElementById("overlay").innerHTML = '<div class="text-loading">ğŸ“ å¤„ç†ä¸Šä¼ éŸ³ä¹...</div>';
            
            const files = event.target.files;
            const reader = new FileReader();

            reader.onload = function(file) {
                const arrayBuffer = file.target.result;
                listener.context.decodeAudioData(arrayBuffer, function(audioBuffer) {
                    audio.setBuffer(audioBuffer);
                    audio.play();
                    isPlaying = true;
                    document.getElementById('music-icon').textContent = 'â¸ï¸';
                    analyser = new THREE.AudioAnalyser(audio, fftSize);
                    init();
                }, function(error) {
                    document.getElementById("overlay").innerHTML = 
                        '<div class="text-loading">âŒ éŸ³é¢‘è§£ç å¤±è´¥ï¼Œè¯·é€‰æ‹©å…¶ä»–æ–‡ä»¶</div>';
                });
            };

            reader.readAsArrayBuffer(files[0]);
        }

        function toggleMusic() {
            if (!audio.buffer) return;
            
            if (isPlaying) {
                audio.pause();
                document.getElementById('music-icon').textContent = 'â–¶ï¸';
            } else {
                audio.play();
                document.getElementById('music-icon').textContent = 'â¸ï¸';
            }
            isPlaying = !isPlaying;
        }

        function changeMusic(index) {
            if (index === currentMusicIndex) {
                toggleMusic();
                return;
            }
            loadAudio(index);
        }

        // ç¥ç¦è¯­è½®æ¢
        let messageIndex = 0;
        setInterval(() => {
            const messageEl = document.getElementById('message-text');
            messageEl.style.opacity = '0';
            
            setTimeout(() => {
                messageIndex = (messageIndex + 1) % christmasMessages.length;
                messageEl.innerHTML = christmasMessages[messageIndex];
                messageEl.style.opacity = '1';
            }, 500);
        }, 8000);

        // çª—å£å¤§å°è°ƒæ•´
        window.addEventListener('resize', function() {
            if (camera && renderer && composer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
                composer.setSize(window.innerWidth, window.innerHeight);
            }
        });

        // åˆå§‹æ˜¾ç¤º
        setTimeout(() => {
            document.querySelector('.greeting-section').style.opacity = '1';
        }, 500);
    </script>
</body>
</html>
```

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ£è¯éŸ³ä¹æ ‘ - è€ç‹ç¥ä½ åœ£è¯èŠ‚å¿«ä¹ï¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'Arial Rounded MT Bold', sans-serif;
            background: linear-gradient(135deg, #0a1c30 0%, #1a2b3c 100%);
            color: white;
            overflow: hidden;
            position: relative;
            min-height: 100vh;
        }
        
        /* åœ£è¯è£…é¥°èƒŒæ™¯ */
        .christmas-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
            overflow: hidden;
        }
        
        .holly-leaf {
            position: absolute;
            color: #2e7d32;
            font-size: 40px;
            opacity: 0.3;
        }
        
        .snowflake-bg {
            position: absolute;
            color: white;
            font-size: 20px;
            opacity: 0.4;
            animation: floatBg 20s linear infinite;
        }
        
        @keyframes floatBg {
            0% { transform: translateY(-100px) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(360deg); }
        }
        
        /* ç¥ç¦è¯­å åŠ å±‚ */
        .greeting-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }
        
        .main-greeting {
            font-size: 5rem;
            font-weight: bold;
            margin-bottom: 30px;
            padding: 20px 40px;
            border-radius: 20px;
            background: linear-gradient(135deg, 
                rgba(220, 20, 60, 0.8) 0%,      /* åœ£è¯çº¢ */
                rgba(255, 69, 0, 0.8) 50%,      /* ç«æ©™ */
                rgba(255, 215, 0, 0.8) 100%     /* åœ£è¯é‡‘ */
            );
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 
                0 0 15px rgba(220, 20, 60, 0.5),
                0 0 30px rgba(255, 69, 0, 0.3),
                0 0 45px rgba(255, 215, 0, 0.2);
            animation: greetingGlow 3s ease-in-out infinite alternate;
            border: 3px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: 
                0 10px 30px rgba(220, 20, 60, 0.3),
                inset 0 0 20px rgba(255, 215, 0, 0.2);
        }
        
        @keyframes greetingGlow {
            0% { 
                transform: scale(1) translateY(0);
                text-shadow: 
                    0 0 15px rgba(220, 20, 60, 0.5),
                    0 0 30px rgba(255, 69, 0, 0.3),
                    0 0 45px rgba(255, 215, 0, 0.2);
            }
            100% { 
                transform: scale(1.05) translateY(-5px);
                text-shadow: 
                    0 0 20px rgba(220, 20, 60, 0.7),
                    0 0 40px rgba(255, 69, 0, 0.5),
                    0 0 60px rgba(255, 215, 0, 0.3),
                    0 0 80px rgba(50, 205, 50, 0.2);
            }
        }
        
        .special-name {
            color: #ffd700;  /* é‡‘è‰² */
            text-shadow: 
                0 0 10px #ffd700,
                0 0 20px #ff4500,
                0 0 30px #dc143c;
            font-style: italic;
            position: relative;
            display: inline-block;
        }
        
        .special-name::after {
            content: 'ğŸ…';
            position: absolute;
            right: -40px;
            top: -10px;
            font-size: 30px;
            animation: santaJump 2s infinite;
        }
        
        @keyframes santaJump {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(20deg); }
        }
        
        .sub-greeting {
            font-size: 2.5rem;
            color: #32cd32;  /* åœ£è¯ç»¿ */
            margin-bottom: 40px;
            padding: 15px 30px;
            background: rgba(46, 125, 50, 0.2);
            border-radius: 15px;
            border: 2px solid rgba(50, 205, 50, 0.4);
            text-shadow: 0 0 15px rgba(50, 205, 50, 0.7);
            animation: subGreetingFloat 4s infinite ease-in-out;
        }
        
        @keyframes subGreetingFloat {
            0%, 100% { transform: translateY(0) rotate(-1deg); }
            50% { transform: translateY(-10px) rotate(1deg); }
        }
        
        .message-container {
            background: linear-gradient(135deg, 
                rgba(25, 25, 112, 0.8) 0%,      /* åˆå¤œè“ */
                rgba(70, 130, 180, 0.8) 100%    /* é’¢è“ */
            );
            padding: 30px;
            border-radius: 20px;
            max-width: 800px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 215, 0, 0.4);
            box-shadow: 
                0 15px 35px rgba(0, 0, 0, 0.5),
                inset 0 0 30px rgba(255, 215, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .message-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, 
                rgba(255, 215, 0, 0.1) 0%, 
                transparent 70%);
            animation: shimmer 6s linear infinite;
        }
        
        @keyframes shimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .message {
            font-size: 1.8rem;
            line-height: 1.8;
            color: #ffebcd;  /* æä»ç™½ */
            text-shadow: 0 0 10px rgba(255, 235, 205, 0.5);
            position: relative;
            z-index: 2;
        }
        
        .christmas-emoji {
            display: inline-block;
            animation: emojiBounce 2s infinite;
            margin: 0 10px;
        }
        
        @keyframes emojiBounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.2); }
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            position: fixed;
            bottom: 30px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 1001;
            pointer-events: auto;
        }
        
        .music-btn {
            background: linear-gradient(135deg, #dc143c, #ff4500);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 
                0 5px 20px rgba(220, 20, 60, 0.5),
                inset 0 0 10px rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px solid rgba(255, 215, 0, 0.5);
        }
        
        .music-btn:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 10px 30px rgba(220, 20, 60, 0.7),
                inset 0 0 15px rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, #ff4500, #dc143c);
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        /* åŠ è½½ç•Œé¢ */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a1c30, #1a2b3c);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1s;
        }
        
        .loading-content {
            text-align: center;
            max-width: 800px;
            padding: 40px;
            background: rgba(25, 25, 112, 0.8);
            border-radius: 20px;
            border: 3px solid rgba(255, 215, 0, 0.4);
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
        }
        
        .loading-title {
            font-size: 3.5rem;
            color: #ffd700;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #ffd700;
            animation: titlePulse 2s infinite alternate;
        }
        
        @keyframes titlePulse {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.05); opacity: 1; }
        }
        
        .loading-greeting {
            font-size: 2.2rem;
            color: #32cd32;
            margin-bottom: 30px;
            padding: 15px;
            background: rgba(46, 125, 50, 0.2);
            border-radius: 15px;
            border: 2px solid rgba(50, 205, 50, 0.3);
        }
        
        .btn {
            background: linear-gradient(135deg, #32cd32, #228b22);
            color: white;
            border: none;
            padding: 15px 35px;
            margin: 12px;
            border-radius: 25px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(50, 205, 50, 0.5);
            border: 2px solid rgba(255, 215, 0, 0.5);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(50, 205, 50, 0.7);
            background: linear-gradient(135deg, #228b22, #32cd32);
        }
        
        .upload-btn {
            background: linear-gradient(135deg, #4169e1, #1e90ff);
        }
        
        .upload-btn:hover {
            background: linear-gradient(135deg, #1e90ff, #4169e1);
        }
        
        .text-loading {
            font-size: 2.5rem;
            color: #ffd700;
            text-shadow: 0 0 20px #ffd700;
            animation: loadingSpin 2s linear infinite;
            margin: 30px 0;
        }
        
        @keyframes loadingSpin {
            0% { transform: rotate(0deg); opacity: 0.5; }
            50% { transform: rotate(180deg); opacity: 1; }
            100% { transform: rotate(360deg); opacity: 0.5; }
        }
        
        .loading-hint {
            color: #87ceeb;
            font-size: 1.2rem;
            margin-top: 30px;
            line-height: 1.6;
            max-width: 600px;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .main-greeting {
                font-size: 3.5rem;
                padding: 15px 25px;
            }
            
            .sub-greeting {
                font-size: 2rem;
            }
            
            .message {
                font-size: 1.5rem;
            }
        }
        
        @media (max-width: 768px) {
            .main-greeting {
                font-size: 2.5rem;
                padding: 12px 20px;
            }
            
            .sub-greeting {
                font-size: 1.5rem;
                padding: 10px 20px;
            }
            
            .message-container {
                padding: 20px;
                margin: 0 15px;
            }
            
            .message {
                font-size: 1.2rem;
            }
            
            .control-panel {
                flex-direction: column;
                align-items: center;
                bottom: 20px;
            }
            
            .btn-group {
                flex-direction: column;
                align-items: center;
            }
            
            .music-btn {
                padding: 12px 25px;
                font-size: 16px;
            }
            
            .loading-title {
                font-size: 2.5rem;
            }
            
            .loading-greeting {
                font-size: 1.8rem;
            }
            
            .btn {
                padding: 12px 25px;
                font-size: 18px;
            }
        }
        
        /* é›ªèŠ±è£…é¥° */
        .snow-decor {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        /* ç¤¼ç‰©è£…é¥° */
        .gift-decor {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #dc143c, #ff4500);
            border-radius: 8px;
            transform: rotate(45deg);
            animation: giftFloat 4s infinite ease-in-out;
            z-index: 1;
        }
        
        .gift-decor::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 10px;
            background: #ffd700;
            border-radius: 5px 5px 0 0;
        }
        
        @keyframes giftFloat {
            0%, 100% { transform: rotate(45deg) translateY(0); }
            50% { transform: rotate(45deg) translateY(-20px); }
        }
    </style>
</head>
<body>
    <!-- åœ£è¯è£…é¥°èƒŒæ™¯ -->
    <div class="christmas-bg" id="christmas-bg"></div>
    <div class="snow-decor" id="snow-decor"></div>
    
    <!-- ç¥ç¦è¯­å±‚ -->
    <div class="greeting-overlay">
        <div class="main-greeting">
            <span class="special-name">è€ç‹</span>ç¥ä½ åœ£è¯èŠ‚å¿«ä¹ï¼
        </div>
        <div class="sub-greeting">ğŸ„ åœ£è¯éŸ³ä¹æ ‘ Â· ä¸“å±ç¥ç¦ ğŸ„</div>
        <div class="message-container">
            <div class="message" id="message-text">
                åœ¨è¿™ç¾å¦™çš„åœ£è¯å­£èŠ‚ï¼Œ<span class="christmas-emoji">ğŸ…</span> 
                æ„¿éŸ³ä¹ä¸ç¥ç¦é™ªä¼´ä½ åº¦è¿‡æ¸©é¦¨æ—¶å…‰ã€‚<span class="christmas-emoji">ğŸŒŸ</span><br>
                åœ£è¯æ ‘çš„æ¯ä¸€é“å…‰éƒ½åœ¨ä¸ºä½ é—ªè€€ï¼Œ<span class="christmas-emoji">âœ¨</span> 
                æ„¿ä½ çš„ç”Ÿæ´»å……æ»¡æ¬¢ä¹ä¸å¥‡è¿¹ï¼<span class="christmas-emoji">ğŸ</span>
            </div>
        </div>
    </div>
    
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
        <button class="music-btn" onclick="toggleMusic()">
            <span id="music-icon">â–¶ï¸</span> æ’­æ”¾/æš‚åœ
        </button>
        <div class="btn-group">
            <button class="music-btn" onclick="changeMusic(0)">
                <span class="christmas-emoji">â„ï¸</span> é›ªèŠ±åœ£è¯
            </button>
            <button class="music-btn" onclick="changeMusic(1)">
                <span class="christmas-emoji">ğŸ…</span> æ¬¢ä¹åœ£è¯
            </button>
            <button class="music-btn" onclick="changeMusic(2)">
                <span class="christmas-emoji">ğŸ””</span> é“ƒå„¿å®å½“
            </button>
            <button class="music-btn" onclick="changeMusic(3)">
                <span class="christmas-emoji">ğŸ„</span> æ¸©æš–åœ£è¯
            </button>
        </div>
    </div>
    
    <!-- åŠ è½½ç•Œé¢ -->
    <div id="overlay">
        <div class="loading-content">
            <div class="loading-title">
                <span class="christmas-emoji">ğŸ„</span> åœ£è¯éŸ³ä¹æ ‘ <span class="christmas-emoji">ğŸ„</span>
            </div>
            <div class="loading-greeting">
                <span class="special-name">è€ç‹</span>ç¥ä½ åœ£è¯èŠ‚å¿«ä¹ï¼
            </div>
            <div style="margin: 30px 0;">
                <p style="color: #ffebcd; font-size: 1.5rem; margin-bottom: 20px;">
                    é€‰æ‹©ä¸€é¦–åœ£è¯éŸ³ä¹å¼€å§‹ç¾å¦™æ—…ç¨‹
                </p>
                
                <div style="margin-bottom: 25px;">
                    <button class="btn" onclick="loadAudio(0)">
                        <span class="christmas-emoji">â„ï¸</span> é›ªèŠ±åœ£è¯
                    </button>
                    <button class="btn" onclick="loadAudio(1)">
                        <span class="christmas-emoji">ğŸ…</span> æ¬¢ä¹åœ£è¯
                    </button>
                    <button class="btn" onclick="loadAudio(2)">
                        <span class="christmas-emoji">ğŸ””</span> é“ƒå„¿å®å½“
                    </button>
                    <button class="btn" onclick="loadAudio(3)">
                        <span class="christmas-emoji">ğŸ„</span> æ¸©æš–åœ£è¯
                    </button>
                </div>
                
                <label style="display: inline-block;">
                    <input type="file" accept="audio/*" style="display: none;" onchange="uploadAudio(event)">
                    <div class="btn upload-btn">
                        <span class="christmas-emoji">ğŸ“</span> ä¸Šä¼ æœ¬åœ°éŸ³ä¹
                    </div>
                </label>
            </div>
            
            <div class="text-loading" id="loading-text">
                ğŸµ å‡†å¤‡åœ£è¯é­”æ³• ğŸµ
            </div>
            
            <div class="loading-hint">
                <span class="christmas-emoji">âœ¨</span> éŸ³ä¹å¯è§†åŒ–æ•ˆæœä¼šéšèŠ‚å¥å˜åŒ–<br>
                <span class="christmas-emoji">ğŸ„</span> åœ£è¯æ ‘ä¼šéšç€éŸ³ä¹è·³åŠ¨å‘å…‰<br>
                <span class="christmas-emoji">ğŸ</span> ä¸“ä¸ºè€ç‹å®šåˆ¶çš„åœ£è¯éŸ³ä¹ä½“éªŒ
            </div>
        </div>
    </div>

    <!-- Three.js åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>

    <script>
        // åœ£è¯ç¥ç¦è¯­æ•°ç»„
        const christmasMessages = [
            "åœ¨è¿™ç¾å¦™çš„åœ£è¯å­£èŠ‚ï¼ŒğŸ… æ„¿éŸ³ä¹ä¸ç¥ç¦é™ªä¼´ä½ åº¦è¿‡æ¸©é¦¨æ—¶å…‰ã€‚ğŸŒŸ åœ£è¯æ ‘çš„æ¯ä¸€é“å…‰éƒ½åœ¨ä¸ºä½ é—ªè€€ï¼Œâœ¨ æ„¿ä½ çš„ç”Ÿæ´»å……æ»¡æ¬¢ä¹ä¸å¥‡è¿¹ï¼ğŸ",
            "åœ£è¯é’Ÿå£°å“èµ·æ—¶ï¼ŒğŸ”” æ„¿æ‰€æœ‰çš„ç¾å¥½éƒ½é™ä¸´åœ¨ä½ èº«è¾¹ã€‚ğŸŒŸ æ„¿è¿™ä¸ªåœ£è¯èŠ‚å¸¦ç»™ä½ æ— é™çš„æ¬¢ä¹ï¼ŒğŸ„ æ–°å¹´çš„æ¯ä¸€å¤©éƒ½ç¿çƒ‚å¦‚å…‰ï¼âœ¨",
            "é›ªèŠ±é£˜è½çš„å­£èŠ‚ï¼Œâ„ï¸ æ„¿æ¸©æš–å¸¸é©»ä½ å¿ƒé—´ã€‚ğŸ… åœ£è¯çš„é­”æ³•å·²ç»é™ä¸´ï¼Œâœ¨ æ„¿è€ç‹çš„ç”Ÿæ´»å……æ»¡æƒŠå–œä¸ç¾å¥½ï¼ğŸ",
            "ä»åœ£è¯æ ‘çš„å…‰èŠ’åˆ°æ–°å¹´çš„æ›™å…‰ï¼ŒğŸŒŸ æ„¿å¹¸ç¦ä¸ä½ ä¸€è·¯åŒè¡Œã€‚ğŸ„ åœ¨è¿™ä¸ªç‰¹åˆ«çš„èŠ‚æ—¥é‡Œï¼Œâœ¨ é€ä¸Šæœ€çœŸæŒšçš„ç¥ç¦ï¼ğŸ…",
            "æ„¿åœ£è¯çš„æ­Œå£°ğŸµ å¸¦ç»™ä½ å¹³å®‰å–œä¹ï¼ŒğŸ„ æ„¿æ–°å¹´çš„é’Ÿå£°ğŸ”” æ•²å“å¹¸ç¦çš„ç¯‡ç« ã€‚âœ¨ è€ç‹ï¼Œç¥ä½ åœ£è¯å¿«ä¹ï¼Œæ–°å¹´å¦‚æ„ï¼ğŸ"
        ];

        const { PI, sin, cos } = Math;
        const TAU = 2 * PI;

        const map = (value, sMin, sMax, dMin, dMax) => {
            return dMin + ((value - sMin) / (sMax - sMin)) * (dMax - dMin);
        };
        
        const range = (n, m = 0) =>
            Array(n)
            .fill(m)
            .map((i, j) => i + j);

        const rand = (max, min = 0) => min + Math.random() * (max - min);
        const randInt = (max, min = 0) => Math.floor(min + Math.random() * (max - min));
        const randChoise = (arr) => arr[randInt(arr.length)];
        const polar = (ang, r = 1) => [r * cos(ang), r * sin(ang)];

        let scene, camera, renderer, analyser;
        let step = 0;
        const uniforms = {
            time: { type: "f", value: 0.0 },
            step: { type: "f", value: 0.0 },
        };
        const params = {
            exposure: 1,
            bloomStrength: 1.2,  // å¢å¼ºå‘å…‰æ•ˆæœ
            bloomThreshold: 0,
            bloomRadius: 0.8,
        };
        let composer;
        let currentMusicIndex = 0;
        let isPlaying = false;

        const fftSize = 2048;
        const totalPoints = 4000;

        const listener = new THREE.AudioListener();
        const audio = new THREE.Audio(listener);

        // åˆ›å»ºåœ£è¯è£…é¥°èƒŒæ™¯
        function createChristmasBackground() {
            const bg = document.getElementById('christmas-bg');
            const snow = document.getElementById('snow-decor');
            
            // åˆ›å»ºå†¬é’å¶
            for (let i = 0; i < 20; i++) {
                const holly = document.createElement('div');
                holly.className = 'holly-leaf';
                holly.innerHTML = 'ğŸ„';
                holly.style.left = `${Math.random() * 100}%`;
                holly.style.top = `${Math.random() * 100}%`;
                holly.style.transform = `rotate(${Math.random() * 360}deg) scale(${0.5 + Math.random()})`;
                holly.style.animationDelay = `${Math.random() * 5}s`;
                bg.appendChild(holly);
            }
            
            // åˆ›å»ºèƒŒæ™¯é›ªèŠ±
            for (let i = 0; i < 30; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake-bg';
                snowflake.innerHTML = 'â„';
                snowflake.style.left = `${Math.random() * 100}%`;
                snowflake.style.animationDuration = `${15 + Math.random() * 20}s`;
                snowflake.style.animationDelay = `${Math.random() * 10}s`;
                snow.appendChild(snowflake);
            }
            
            // åˆ›å»ºç¤¼ç‰©è£…é¥°
            for (let i = 0; i < 8; i++) {
                const gift = document.createElement('div');
                gift.className = 'gift-decor';
                gift.style.left = `${10 + Math.random() * 80}%`;
                gift.style.top = `${10 + Math.random() * 80}%`;
                gift.style.animationDelay = `${Math.random() * 3}s`;
                gift.style.background = `linear-gradient(135deg, ${randChoise(['#dc143c', '#ff4500', '#32cd32', '#1e90ff'])}, ${randChoise(['#ffd700', '#ff69b4', '#9370db', '#00ced1'])})`;
                bg.appendChild(gift);
            }
        }

        function init() {
            createChristmasBackground();
            
            const overlay = document.getElementById("overlay");
            overlay.style.opacity = "0";
            setTimeout(() => {
                overlay.style.display = "none";
            }, 1000);

            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x0a1c30, 10, 50);
            
            renderer = new THREE.WebGLRenderer({ 
                antialias: true,
                alpha: true 
            });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x0a1c30, 1);
            document.body.appendChild(renderer.domElement);

            camera = new THREE.PerspectiveCamera(
                60,
                window.innerWidth / window.innerHeight,
                1,
                1000
            );
            camera.position.set(-0.094, -2.56, 24.42);
            camera.rotation.set(0.104, -0.004, 0.0004);

            const format = renderer.capabilities.isWebGL2 ?
                THREE.RedFormat :
                THREE.LuminanceFormat;

            uniforms.tAudioData = {
                value: new THREE.DataTexture(analyser.data, fftSize / 2, 1, format),
            };

            // åˆ›å»ºä¸»åœ£è¯æ ‘
            addChristmasTree(scene, uniforms, totalPoints, [0, -5, 0]);
            
            // åˆ›å»ºå‘¨å›´çš„å°æ ‘
            range(6).map((i) => {
                const angle = (i / 6) * TAU;
                const x = Math.cos(angle) * 12;
                const z = Math.sin(angle) * 12;
                addSmallTree(scene, uniforms, totalPoints / 2, [x, -5, z]);
            });

            // æ·»åŠ é›ªèŠ±
            addSnow(scene);
            
            // æ·»åŠ æ˜Ÿå…‰
            addStars(scene);
            
            // æ·»åŠ åœ°é¢
            addGround(scene);

            const renderScene = new THREE.RenderPass(scene, camera);

            const bloomPass = new THREE.UnrealBloomPass(
                new THREE.Vector2(window.innerWidth, window.innerHeight),
                params.bloomStrength,
                params.bloomThreshold,
                params.bloomRadius
            );

            composer = new THREE.EffectComposer(renderer);
            composer.addPass(renderScene);
            composer.addPass(bloomPass);

            // è‡ªåŠ¨æ—‹è½¬ç›¸æœº
            let autoRotate = true;
            setInterval(() => {
                if (autoRotate) {
                    camera.position.x = Math.sin(Date.now() * 0.0003) * 18;
                    camera.position.z = Math.cos(Date.now() * 0.0003) * 18;
                    camera.lookAt(0, 0, 0);
                }
            }, 16);
            
            // ç‚¹å‡»æš‚åœè‡ªåŠ¨æ—‹è½¬
            renderer.domElement.addEventListener('click', () => {
                autoRotate = false;
                setTimeout(() => autoRotate = true, 8000);
            });

            animate();
        }

        function addChristmasTree(scene, uniforms, totalPoints, position) {
            const vertexShader = `
                attribute float mIndex;
                varying vec3 vColor;
                varying float opacity;
                uniform sampler2D tAudioData;
                uniform float time;
                uniform float step;
                
                float norm(float value, float min, float max){
                    return (value - min) / (max - min);
                }
                
                void main() {
                    float audioValue = texture2D(tAudioData, vec2(norm(mIndex, 0.0, ${totalPoints.toFixed(1)}), 0.0)).r;
                    
                    // åœ£è¯æ ‘å½¢çŠ¶
                    float height = position.y;
                    float radius = (1.0 - height) * 2.0;
                    float angle = position.x * 3.14159 * 2.0;
                    
                    vec3 pos = position;
                    pos.x = radius * cos(angle + time * 0.3) * (1.0 + audioValue * 0.8);
                    pos.z = radius * sin(angle + time * 0.3) * (1.0 + audioValue * 0.8);
                    pos.y = height * 3.0;
                    
                    // éŸ³é¢‘å“åº”
                    pos.y += audioValue * 2.5;
                    pos.x += sin(time * 2.0 + mIndex * 0.1) * audioValue * 0.5;
                    pos.z += cos(time * 2.0 + mIndex * 0.1) * audioValue * 0.5;
                    
                    // åœ£è¯é¢œè‰²
                    float r = 0.2 + height * 0.6 + audioValue * 0.4;
                    float g = 0.8 - height * 0.3 + audioValue * 0.3;
                    float b = 0.2 + audioValue * 0.6;
                    
                    vColor = vec3(r, g, b);
                    opacity = 0.8 + audioValue * 0.4;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos + vec3(${position[0]}, ${position[1]}, ${position[2]}), 1.0);
                    gl_PointSize = 4.0 + audioValue * 15.0;
                }
            `;
            
            const fragmentShader = `
                varying vec3 vColor;
                varying float opacity;
                
                void main() {
                    float dist = distance(gl_PointCoord, vec2(0.5, 0.5));
                    if (dist > 0.5) discard;
                    
                    float alpha = (1.0 - dist * 2.0) * opacity;
                    gl_FragColor = vec4(vColor, alpha);
                }
            `;

            const geometry = new THREE.BufferGeometry();
            const positions = [];
            const indices = [];
            
            for (let i = 0; i < totalPoints; i++) {
                const height = Math.random();
                const angle = Math.random() * TAU;
                const radius = (1 - height) * Math.random() * 0.9;
                
                positions.push(
                    radius * cos(angle),
                    height,
                    radius * sin(angle)
                );
                indices.push(i);
            }
            
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('mIndex', new THREE.Float32BufferAttribute(indices, 1));
            
            const material = new THREE.ShaderMaterial({
                uniforms: Object.assign({}, uniforms, {
                    tAudioData: uniforms.tAudioData
                }),
                vertexShader: vertexShader,
                fragmentShader: fragmentShader,
                transparent: true,
                blending: THREE.AdditiveBlending
            });
            
            const tree = new THREE.Points(geometry, material);
            scene.add(tree);
            
            return tree;
        }

        function addSmallTree(scene, uniforms, totalPoints, position) {
            const tree = addChristmasTree(scene, uniforms, totalPoints, position);
            tree.scale.set(0.4, 0.4, 0.4);
            return tree;
        }

        function addSnow(scene) {
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            const snowCount = 3000;
            
            for (let i = 0; i < snowCount; i++) {
                vertices.push(
                    (Math.random() - 0.5) * 100,
                    Math.random() * 50 - 10,
                    (Math.random() - 0.5) * 100
                );
            }
            
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            
            const material = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.15,
                transparent: true,
                opacity: 0.7
            });
            
            const snow = new THREE.Points(geometry, material);
            scene.add(snow);
            
            // é›ªèŠ±åŠ¨ç”»
            function animateSnow() {
                const positions = snow.geometry.attributes.position.array;
                for (let i = 1; i < positions.length; i += 3) {
                    positions[i] -= 0.02;
                    if (positions[i] < -10) positions[i] = 40;
                }
                snow.geometry.attributes.position.needsUpdate = true;
                requestAnimationFrame(animateSnow);
            }
            animateSnow();
        }

        function addStars(scene) {
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            const colors = [];
            const starCount = 1000;
            
            for (let i = 0; i < starCount; i++) {
                vertices.push(
                    (Math.random() - 0.5) * 200,
                    Math.random() * 100 - 30,
                    (Math.random() - 0.5) * 200
                );
                
                // æ˜Ÿæ˜Ÿé¢œè‰²
                colors.push(
                    0.8 + Math.random() * 0.2,
                    0.8 + Math.random() * 0.2,
                    0.8 + Math.random() * 0.2
                );
            }
            
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
            
            const material = new THREE.PointsMaterial({
                size: 0.3,
                vertexColors: true,
                transparent: true,
                opacity: 0.6
            });
            
            const stars = new THREE.Points(geometry, material);
            scene.add(stars);
        }

        function addGround(scene) {
            const geometry = new THREE.PlaneGeometry(100, 100);
            const material = new THREE.MeshBasicMaterial({
                color: 0x1a472a,
                transparent: true,
                opacity: 0.3
            });
            
            const ground = new THREE.Mesh(geometry, material);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -10;
            scene.add(ground);
        }

        function animate(time) {
            if (analyser) {
                analyser.getFrequencyData();
                uniforms.tAudioData.value.needsUpdate = true;
            }
            step = (step + 1) % 1000;
            uniforms.time.value = time * 0.001;
            uniforms.step.value = step;
            composer.render();
            requestAnimationFrame(animate);
        }

        // è¿™é‡Œå¯ä»¥æ›¿æ¢ä¸ºä½ è‡ªå·±çš„éŸ³ä¹é“¾æ¥
        const musicFiles = [
            "https://files.freemusicarchive.org/storage-freemusicarchive-org/music/no_curator/Simon_Panrucker/Happy_Christmas_You_Guys/Simon_Panrucker_-_01_-_Snowflakes_Falling_Down.mp3",
            "https://files.freemusicarchive.org/storage-freemusicarchive-org/music/no_curator/Dott/This_Christmas/Dott_-_01_-_This_Christmas.mp3",
            "https://files.freemusicarchive.org/storage-freemusicarchive-org/music/ccCommunity/TRG_Banks/TRG_Banks_Christmas_Album/TRG_Banks_-_12_-_No_room_at_the_inn.mp3",
            "https://files.freemusicarchive.org/storage-freemusicarchive-org/music/ccCommunity/Mark_Smeby/En_attendant_Nol/Mark_Smeby_-_07_-_Jingle_Bell_Swing.mp3",
        ];

        function loadAudio(index) {
            currentMusicIndex = index;
            document.getElementById("overlay").innerHTML = '<div class="text-loading">ğŸµ åŠ è½½åœ£è¯éŸ³ä¹ä¸­...</div>';
            
            const loader = new THREE.AudioLoader();
            loader.load(musicFiles[index], function(buffer) {
                audio.setBuffer(buffer);
                audio.play();
                isPlaying = true;
                document.getElementById('music-icon').textContent = 'â¸ï¸';
                analyser = new THREE.AudioAnalyser(audio, fftSize);
                init();
            });
        }

        function uploadAudio(event) {
            document.getElementById("overlay").innerHTML = '<div class="text-loading">ğŸ“ å¤„ç†ä¸Šä¼ éŸ³ä¹...</div>';
            
            const files = event.target.files;
            const reader = new FileReader();

            reader.onload = function(file) {
                const arrayBuffer = file.target.result;
                listener.context.decodeAudioData(arrayBuffer, function(audioBuffer) {
                    audio.setBuffer(audioBuffer);
                    audio.play();
                    isPlaying = true;
                    document.getElementById('music-icon').textContent = 'â¸ï¸';
                    analyser = new THREE.AudioAnalyser(audio, fftSize);
                    init();
                });
            };

            reader.readAsArrayBuffer(files[0]);
        }

        function toggleMusic() {
            if (!audio.buffer) return;
            
            if (isPlaying) {
                audio.pause();
                document.getElementById('music-icon').textContent = 'â–¶ï¸';
            } else {
                audio.play();
                document.getElementById('music-icon').textContent = 'â¸ï¸';
            }
            isPlaying = !isPlaying;
        }

        function changeMusic(index) {
            if (index === currentMusicIndex) {
                toggleMusic();
                return;
            }
            loadAudio(index);
        }

        // ç¥ç¦è¯­è½®æ¢
        let messageIndex = 0;
        setInterval(() => {
            const messageEl = document.getElementById('message-text');
            messageEl.style.opacity = '0';
            
            setTimeout(() => {
                messageIndex = (messageIndex + 1) % christmasMessages.length;
                messageEl.innerHTML = christmasMessages[messageIndex];
                messageEl.style.opacity = '1';
            }, 500);
        }, 8000);

        // çª—å£å¤§å°è°ƒæ•´
        window.addEventListener('resize', function() {
            if (camera && renderer && composer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
                composer.setSize(window.innerWidth, window.innerHeight);
            }
        });

        // åˆå§‹æ˜¾ç¤º
        setTimeout(() => {
            document.querySelector('.greeting-overlay').style.opacity = '1';
        }, 1000);
    </script>
</body>
</html>
```
